<!DOCTYPE html><html lang="vi">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ghi ch√∫ x∆∞·ªüng s·∫£n xu·∫•t</title>
<style>
body{font-family:Arial,Helvetica,sans-serif;margin:0;background:#f4f4f4}
header{background:#222;color:#fff;padding:10px;display:flex;flex-wrap:wrap;gap:6px;align-items:center}
header button{padding:8px 12px;border:none;border-radius:6px;font-weight:bold;cursor:pointer}
header input{flex:1;padding:8px;border-radius:6px;border:none}
nav button{background:#555;color:#fff}
nav button.active{background:#2196F3}
section{display:none;padding:10px}
section.active{display:block}
.box{background:#fff;padding:10px;border-radius:8px;margin-bottom:10px}
label{font-weight:bold}
select,input[type=text],textarea{width:100%;padding:6px;margin:4px 0 8px 0}
textarea{min-height:80px}
.list-item{border-bottom:1px solid #ddd;padding:6px 0}
.list-item:last-child{border-bottom:none}
.small{font-size:13px;color:#555}
.actions button{margin-right:5px}
.danger{background:#f44336;color:#fff}
.save{background:#4CAF50;color:#fff}
.edit{background:#FF9800;color:#fff}
.search-result-item{cursor:pointer;transition:background 0.2s;padding:12px!important}
.search-result-item:hover{background:#e8f4fd}
.highlight{background-color:#ffeb3b;font-weight:bold;padding:0 2px;border-radius:2px}
.detail-view{max-width:600px;margin:0 auto}
</style>
</head>
<body>
<header>
  <nav>
    <button onclick="showTab('machine')" class="active">M√°y & H√†ng</button>
    <button onclick="showTab('day')">Ca ng√†y</button>
    <button onclick="showTab('night')">Ca ƒë√™m</button>
  </nav>
  <input type="text" id="searchInput" placeholder="üîç T√¨m ki·∫øm to√†n b·ªô..." oninput="searchAll(this.value)">
  <button onclick="exportData()">Sao l∆∞u</button>
  <button onclick="importFile.click()">Kh√¥i ph·ª•c</button>
  <button class="danger" onclick="resetAll()">Reset</button>
  <input type="file" id="importFile" accept=".json" hidden onchange="importData(this.files[0])">
</header><section id="machine" class="active">
  <div class="box">
    <label>Ch·ªçn m√°y</label>
    <select id="machineSelect" onchange="renderProducts()"></select>
    <button onclick="addProduct()">‚ûï Th√™m lo·∫°i h√†ng</button>
  </div>
  <div id="productList"></div>
</section><section id="day">
  <div class="box">
    <label>Ghi ch√∫ ca ng√†y</label>
    <textarea id="dayNote"></textarea>
    <button class="save" onclick="saveShift('day')">L∆∞u</button>
    <button class="danger" onclick="clearShift('day')">X√≥a</button>
  </div>
</section><section id="night">
  <div class="box">
    <label>Ghi ch√∫ ca ƒë√™m</label>
    <textarea id="nightNote"></textarea>
    <button class="save" onclick="saveShift('night')">L∆∞u</button>
    <button class="danger" onclick="clearShift('night')">X√≥a</button>
  </div>
</section><section id="searchResult"></section><script>
const MACHINES = ['1A','1B','2A','2B','3A','3B'];
let data = JSON.parse(localStorage.getItem('factoryData')) || {
  machines:{}, dayNote:'', nightNote:''
};
MACHINES.forEach(m=>data.machines[m]=data.machines[m]||[]);

function save(){localStorage.setItem('factoryData',JSON.stringify(data));}

function showTab(id){
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  document.querySelector(`nav button[onclick*=${id}]`).classList.add('active');
  document.getElementById(id).classList.add('active');
}

function init(){
  const sel=document.getElementById('machineSelect');
  MACHINES.forEach(m=>sel.innerHTML+=`<option>${m}</option>`);
  document.getElementById('dayNote').value=data.dayNote;
  document.getElementById('nightNote').value=data.nightNote;
  renderProducts();
}

function renderProducts(){
  const m=document.getElementById('machineSelect').value;
  const list=document.getElementById('productList');
  list.innerHTML='';
  data.machines[m].forEach((p,i)=>{
    list.innerHTML+=`<div class="box list-item">
      <b>${p.name}</b> <span class="small">(${p.length})</span>
      <div class="small">Chu·∫©n b·ªã: ${p.prepare}</div>
      <div class="small">L∆∞u √Ω: ${p.note}</div>
      <div class="actions">
        <button class="edit" onclick="editProduct('${m}',${i})">S·ª≠a</button>
        <button class="danger" onclick="deleteProduct('${m}',${i})">X√≥a</button>
      </div>
    </div>`;
  });
}

function addProduct(){
  const m=machineSelect.value;
  const name=prompt('T√™n lo·∫°i h√†ng'); if(!name) return;
  const length=prompt('Chi·ªÅu d√†i');
  const prepare=prompt('Chu·∫©n b·ªã');
  const note=prompt('L∆∞u √Ω');
  data.machines[m].push({name,length,prepare,note});
  save(); renderProducts();
}

function editProduct(m,i){
  const p=data.machines[m][i];
  p.name=prompt('T√™n lo·∫°i h√†ng',p.name)||p.name;
  p.length=prompt('Chi·ªÅu d√†i',p.length)||p.length;
  p.prepare=prompt('Chu·∫©n b·ªã',p.prepare)||p.prepare;
  p.note=prompt('L∆∞u √Ω',p.note)||p.note;
  save(); renderProducts();
}

function deleteProduct(m,i){
  if(confirm('X√≥a lo·∫°i h√†ng n√†y?')){
    data.machines[m].splice(i,1); save(); renderProducts();
  }
}

function saveShift(t){
  data[t+'Note']=document.getElementById(t+'Note').value; save();
}
function clearShift(t){
  if(confirm('X√≥a ghi ch√∫?')){data[t+'Note']='';document.getElementById(t+'Note').value='';save();}
}

function exportData(){
  const blob=new Blob([JSON.stringify(data,null,2)],{type:'application/json'});
  const a=document.createElement('a');
  a.href=URL.createObjectURL(blob);
  a.download='ghi-chu-xuong.json'; a.click();
}

function importData(file){
  const r=new FileReader();
  r.onload=()=>{ if(confirm('Ghi ƒë√® to√†n b·ªô d·ªØ li·ªáu?')){
    data=JSON.parse(r.result); save(); location.reload(); }};
  r.readAsText(file);
}

function resetAll(){ if(confirm('X√≥a T·∫§T C·∫¢ d·ªØ li·ªáu?')){localStorage.removeItem('factoryData');location.reload();}}

// H√†m t√¥ s√°ng t·ª´ kh√≥a t√¨m ki·∫øm
function highlightText(text, query) {
  if (!query) return text;
  const regex = new RegExp(`(${query.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
  return text.replace(regex, '<span class="highlight">$1</span>');
}

// Hi·ªÉn th·ªã chi ti·∫øt s·∫£n ph·∫©m
function showProductDetail(machine, productIndex) {
  const product = data.machines[machine][productIndex];
  const query = document.getElementById('searchInput').value.toLowerCase();
  
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  
  const detailHTML = `
    <div class="detail-view">
      <div class="box">
        <button onclick="backToSearch()" style="margin-bottom:10px;background:#666;color:white">‚Üê Quay l·∫°i t√¨m ki·∫øm</button>
        <h2>üìå M√°y ${machine} - ${product.name}</h2>
        <div class="small" style="margin-top:10px">
          <div><strong>Chi·ªÅu d√†i:</strong> ${highlightText(product.length, query)}</div>
          <div><strong>Chu·∫©n b·ªã:</strong> ${highlightText(product.prepare, query)}</div>
          <div><strong>L∆∞u √Ω:</strong> ${highlightText(product.note, query)}</div>
        </div>
        <div style="margin-top:20px">
          <button class="edit" onclick="editProduct('${machine}',${productIndex});backToSearch()">S·ª≠a</button>
          <button class="danger" onclick="deleteProduct('${machine}',${productIndex});backToSearch()">X√≥a</button>
          <button onclick="showMachineTab('${machine}')">Xem trong danh s√°ch m√°y</button>
        </div>
      </div>
    </div>
  `;
  
  document.getElementById('searchResult').innerHTML = detailHTML;
  document.getElementById('searchResult').classList.add('active');
}

// Hi·ªÉn th·ªã chi ti·∫øt ca l√†m vi·ªác
function showShiftDetail(shiftType) {
  const query = document.getElementById('searchInput').value.toLowerCase();
  const shiftName = shiftType === 'day' ? 'Ca ng√†y ‚òÄÔ∏è' : 'Ca ƒë√™m üåô';
  const content = shiftType === 'day' ? data.dayNote : data.nightNote;
  
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  
  const detailHTML = `
    <div class="detail-view">
      <div class="box">
        <button onclick="backToSearch()" style="margin-bottom:10px;background:#666;color:white">‚Üê Quay l·∫°i t√¨m ki·∫øm</button>
        <h2>${shiftName}</h2>
        <div style="margin-top:15px;padding:15px;background:#f9f9f9;border-radius:5px;white-space:pre-wrap">
          ${highlightText(content, query)}
        </div>
        <div style="margin-top:20px">
          <button onclick="showTab('${shiftType}')">Ch·ªânh s·ª≠a trong tab ${shiftType === 'day' ? 'Ca ng√†y' : 'Ca ƒë√™m'}</button>
        </div>
      </div>
    </div>
  `;
  
  document.getElementById('searchResult').innerHTML = detailHTML;
  document.getElementById('searchResult').classList.add('active');
}

// Quay l·∫°i t√¨m ki·∫øm
function backToSearch() {
  const query = document.getElementById('searchInput').value;
  searchAll(query);
}

// Chuy·ªÉn ƒë·∫øn tab m√°y
function showMachineTab(machine) {
  document.getElementById('machineSelect').value = machine;
  showTab('machine');
  renderProducts();
}

// T√¨m ki·∫øm
function searchAll(q) {
  q = q.toLowerCase(); 
  const res = document.getElementById('searchResult');
  
  if (!q) {
    res.innerHTML = '';
    res.classList.remove('active');
    showTab('machine');
    return;
  }
  
  // Hi·ªÉn th·ªã tab k·∫øt qu·∫£ t√¨m ki·∫øm
  document.querySelectorAll('nav button').forEach(b=>b.classList.remove('active'));
  document.querySelectorAll('section').forEach(s=>s.classList.remove('active'));
  res.classList.add('active');
  
  let resultsHTML = '<div class="box"><h3>üîç K·∫øt qu·∫£ t√¨m ki·∫øm cho: "' + q + '"</h3></div>';
  let foundCount = 0;
  
  // T√¨m trong s·∫£n ph·∫©m
  for (const m in data.machines) {
    data.machines[m].forEach((p, i) => {
      const searchText = (m + p.name + p.length + p.prepare + p.note).toLowerCase();
      if (searchText.includes(q)) {
        foundCount++;
        resultsHTML += `
          <div class="box search-result-item" onclick="showProductDetail('${m}', ${i})">
            <div><b>üìå M√°y ${m}</b> - ${highlightText(p.name, q)}</div>
            <div class="small">Chi·ªÅu d√†i: ${highlightText(p.length, q)}</div>
            <div class="small" style="color:#666">Chu·∫©n b·ªã: ${highlightText(p.prepare, q)}</div>
            <div class="small" style="color:#888;font-size:12px">Nh·∫•p ƒë·ªÉ xem chi ti·∫øt...</div>
          </div>
        `;
      }
    });
  }
  
  // T√¨m trong ca ng√†y
  if (data.dayNote.toLowerCase().includes(q)) {
    foundCount++;
    const preview = data.dayNote.length > 100 ? data.dayNote.substring(0, 100) + '...' : data.dayNote;
    resultsHTML += `
      <div class="box search-result-item" onclick="showShiftDetail('day')">
        <div><b>‚òÄÔ∏è Ca ng√†y</b></div>
        <div class="small">${highlightText(preview, q)}</div>
        <div class="small" style="color:#888;font-size:12px">Nh·∫•p ƒë·ªÉ xem chi ti·∫øt...</div>
      </div>
    `;
  }
  
  // T√¨m trong ca ƒë√™m
  if (data.nightNote.toLowerCase().includes(q)) {
    foundCount++;
    const preview = data.nightNote.length > 100 ? data.nightNote.substring(0, 100) + '...' : data.nightNote;
    resultsHTML += `
      <div class="box search-result-item" onclick="showShiftDetail('night')">
        <div><b>üåô Ca ƒë√™m</b></div>
        <div class="small">${highlightText(preview, q)}</div>
        <div class="small" style="color:#888;font-size:12px">Nh·∫•p ƒë·ªÉ xem chi ti·∫øt...</div>
      </div>
    `;
  }
  
  if (foundCount === 0) {
    resultsHTML += '<div class="box">Kh√¥ng t√¨m th·∫•y k·∫øt qu·∫£ n√†o.</div>';
  } else {
    resultsHTML += `<div class="box small">T√¨m th·∫•y ${foundCount} k·∫øt qu·∫£.</div>`;
  }
  
  res.innerHTML = resultsHTML;
}

init();
</script></body>
</html>
